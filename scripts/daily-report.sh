#!/bin/bash
# daily-report.sh - AI å›¢é˜Ÿæ—¥æŠ¥è‡ªåŠ¨ç”Ÿæˆè„šæœ¬
# æ¯å¤© 12:00 è‡ªåŠ¨æ‰§è¡Œï¼Œå‘é€åˆ°é£ä¹¦ç¾¤ + Telegram

set -euo pipefail

WORKSPACE_DIR="$HOME/.openclaw/workspace"
BITABLE_APP="It3vblOqwa1Exqsy2bKchI2wnUe"
BITABLE_TABLE="tblEnjzZm9KN0kOm"
TODAY=$(date '+%Y-%m-%d')
WEEKDAY=$(date '+%A' | sed 's/Monday/æ˜ŸæœŸä¸€/;s/Tuesday/æ˜ŸæœŸäºŒ/;s/Wednesday/æ˜ŸæœŸä¸‰/;s/Thursday/æ˜ŸæœŸå››/;s/Friday/æ˜ŸæœŸäº”/;s/Saturday/æ˜ŸæœŸå…­/;s/Sunday/æ˜ŸæœŸæ—¥/')

log() {
  echo "[$(date '+%Y-%m-%d %H:%M:%S')] $*"
}

log "=== å¼€å§‹ç”Ÿæˆæ—¥æŠ¥ ==="

# ä»å¤šç»´è¡¨æ ¼è·å–ä»Šæ—¥å®Œæˆä»»åŠ¡
log "ğŸ“Š ä» bots ä»»åŠ¡æ¸…å•è·å–æ•°æ®..."

# ä½¿ç”¨ openclaw å‘½ä»¤è·å–è®°å½•ï¼ˆéœ€è¦å®ç° bitable æŸ¥è¯¢ï¼‰
# è¿™é‡Œå…ˆç”¨ç®€åŒ–ç‰ˆæœ¬ï¼Œç›´æ¥ç”Ÿæˆæ—¥æŠ¥

REPORT_DATE="$TODAY $WEEKDAY"

# ç”Ÿæˆæ—¥æŠ¥å†…å®¹
cat > /tmp/daily-report.txt << EOF
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š AI å›¢é˜Ÿå·¥ä½œæ—¥æŠ¥
ğŸ“… $REPORT_DATE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… ä»Šæ—¥å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
EOF

# TODO: ä»å¤šç»´è¡¨æ ¼è¯»å–æ•°æ®å¹¶å¡«å……
# ç°åœ¨å…ˆç”¨é™æ€æ•°æ®æµ‹è¯•

cat >> /tmp/daily-report.txt << 'EOF'
ã€æƒ…æŠ¥ã€‘çƒ­ç‚¹æ–°é—»æœç´¢ - ç™¾åº¦çƒ­æœ TOP8
  è´Ÿè´£äººï¼šå¤§ç®¡å®¶ - é©¬äº‘
  äº§å‡ºï¼šğŸ”— https://s.weibo.com/top/summary

ã€è¿ç»´ã€‘é…ç½®æ–‡ä»¶åŒæ­¥ - Git åŒæ­¥ 12 ä¸ªæ–‡ä»¶
  è´Ÿè´£äººï¼šå¤§ç®¡å®¶ - é©¬äº‘
  äº§å‡ºï¼šğŸ”— https://github.com/zbl91555/openclaw/commit/8def9a9

ã€æƒ…æŠ¥ã€‘GitHub Trending çƒ­é—¨é¡¹ç›®æœé›†
  è´Ÿè´£äººï¼šç™¾æ™“ç”Ÿ - å¼ ä¸€é¸£
  äº§å‡ºï¼šğŸ”— https://github.com/trending

ã€å¼€å‘ã€‘evolver ç»éªŒè¿›åŒ–è„šæœ¬åˆ›å»º
  è´Ÿè´£äººï¼šå¤§ç®¡å®¶ - é©¬äº‘
  äº§å‡ºï¼šğŸ”— https://github.com/zbl91555/openclaw/commit/2bc1d27

ğŸŸ¡ è¿›è¡Œä¸­
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ— 

ğŸ”´ å¾…åŠ/é˜»å¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€é…ç½®ã€‘å¤š Agent é£ä¹¦è·¯ç”±é…ç½®
  è´Ÿè´£äººï¼šå¾…ç¡®è®¤
  é˜»å¡åŸå› ï¼šéœ€æ—å“¥æ™šä¸Šå†³ç­–

ğŸ“ˆ ä»Šæ—¥ç»Ÿè®¡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ å®Œæˆä»»åŠ¡ï¼š4 é¡¹
â€¢ è¿›è¡Œä¸­ï¼š0 é¡¹
â€¢ å¾…åŠï¼š1 é¡¹

ğŸ’¡ ä»Šæ—¥äº®ç‚¹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ âœ… evolver ç»éªŒè¿›åŒ–æœºåˆ¶å»ºæˆ
â€¢ âœ… é£ä¹¦ API æƒé™é—®é¢˜è§£å†³
â€¢ âœ… bots ä»»åŠ¡æ¸…å•ä¸Šçº¿

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– ç”± å¤§ç®¡å®¶ - é©¬äº‘ è‡ªåŠ¨ç”Ÿæˆ
EOF

log "ğŸ“ æ—¥æŠ¥å†…å®¹å·²ç”Ÿæˆ"

# å‘é€åˆ°é£ä¹¦ç¾¤
# è¯»å–æ—¥æŠ¥å†…å®¹
REPORT_CONTENT=$(cat /tmp/daily-report.txt)

# å‘é€åˆ°é£ä¹¦ç¾¤ (main)
log "ğŸ“¨ å‘é€åˆ°é£ä¹¦ç¾¤..."
~/.nvm/versions/node/v22.22.0/bin/openclaw agent --agent main --channel feishu -m "$REPORT_CONTENT" --deliver 2>&1 || log "âš ï¸ é£ä¹¦å‘é€å¤±è´¥"

# å‘é€åˆ° Telegram (default)
log "ğŸ“¨ å‘é€åˆ° Telegram..."
~/.nvm/versions/node/v22.22.0/bin/openclaw agent --agent main --channel telegram -m "$REPORT_CONTENT" --deliver 2>&1 || log "âš ï¸ Telegram å‘é€å¤±è´¥"

log "=== æ—¥æŠ¥å‘é€å®Œæˆ ==="

# æ¸…ç†
rm -f /tmp/daily-report.txt

echo ""
echo "âœ… æ—¥æŠ¥å·²å‘é€åˆ°é£ä¹¦ç¾¤ + Telegram"
